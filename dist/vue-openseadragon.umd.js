(function(a,n){typeof exports=="object"&&typeof module<"u"?module.exports=n(require("openseadragon"),require("vue"),require("@unrest/vue-mousetrap")):typeof define=="function"&&define.amd?define(["openseadragon","vue","@unrest/vue-mousetrap"],n):(a=typeof globalThis<"u"?globalThis:a||self,a["@unrest/vue-openseadragon"]=n(a.openseadragon,a.Vue,a["@unrest/vue-mousetrap"]))})(this,function(a,n,_){"use strict";const p=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},d=p(a),w=p(_),l=(e,o)=>{const t=e.__vccOpts||e;for(const[s,r]of o)t[s]=r;return t},g={props:{id:{type:String,default:"openseadragon-viewer"},options:Object,events:Object,pixelated:Boolean},emits:["viewer-bound"],data(){return{viewer:null}},mounted(){const{...e}=this.options;e.element=this.$el,window.viewer_jawn=this.viewer=new d.default(e);const{viewport:o}=this.viewer;o.centerSpringY.animationTime=.25,o.centerSpringX.animationTime=.25,o.zoomSpring.animationTime=.25,this.bindEvents(),this.$emit("viewer-bound",this.viewer);const t=()=>{if(this.pixelated){const{drawer:s,viewport:r}=this.viewer;s.context.imageSmoothingEnabled=r.getZoom()<.5}};this.viewer.addHandler("zoom",t),this.viewer.addOnceHandler("tile-loaded",t)},methods:{bindEvents(){const{events:e={},viewer:o}=this;Object.entries(e).forEach(([t,s])=>o.addHandler(t,s))}}},f=["id"];function v(e,o,t,s,r,i){return n.openBlock(),n.createElementBlock("div",{id:t.id,class:"osd-wrapper"},null,8,f)}const x={components:{OpenSeadragon:l(g,[["render",v]])},props:{osd_store:Object,editor_mode:Boolean},emits:["viewer-bound"],data(){const{editor_mode:e}=this;return{osd_options:{maxZoomPixelRatio:e?8:4,navigatorAutoFade:!1,showNavigator:!0,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,showRotationControl:!1,debugmode:!1,clickTimeThreshold:1e3,mouseNavEnabled:!e,gestureSettingsMouse:{clickToZoom:!1,dblClickToZoom:!1}},viewer:null}},watch:{editor_mode(){const{viewer:e}=this;e.setMouseNavEnabled(!this.editor_mode),e.viewport.maxZoomPixelRatio=this.editor_mode?8:4}},methods:{osdWheel(e){if(!this.editor_mode)return;const{viewer:o}=this,t=o.viewport;if(e.ctrlKey){const s=o.container.getBoundingClientRect(),r=new d.default.Point(e.pageX-s.left,e.pageY-s.top),i=Math.pow(o.zoomPerScroll,-e.deltaY/20);t.zoomBy(i,t.pointFromPixel(r,!0))}else{const s=t.pixelFromPoint(t.getCenter(!0)),r=t.pointFromPixel(new d.default.Point(s.x+3*e.deltaX,s.y+3*e.deltaY));t.panTo(r,!1)}t.applyConstraints()},callback(e){var o;this.viewer=e,(o=this.osd_store)==null||o.bindViewer(e),this.$emit("viewer-bound",e)}}};function y(e,o,t,s,r,i){const m=n.resolveComponent("open-seadragon");return n.openBlock(),n.createBlock(m,{onMousewheel:n.withModifiers(i.osdWheel,["prevent"]),options:r.osd_options,onViewerBound:i.callback,pixelated:!0},null,8,["onMousewheel","options","onViewerBound"])}const z=l(x,[["render",y]]),b={props:{viewer:Object},mounted(){this.viewer.addOverlay(this.$el,new d.default.Rect(0,0,1,1))}},Z={class:"osd-html__overlay"};function $(e,o,t,s,r,i){return n.openBlock(),n.createElementBlock("div",Z,[n.renderSlot(e.$slots,"default")])}const h=l(b,[["render",$]]),O=()=>{const e=n.reactive({_viewer:null});return{state:e,patch:o=>Object.assign(e,o),get viewer(){return e._viewer},set viewer(o){e._viewer=o&&n.markRaw(o)},bindViewer(o){e._viewer=o,o.addHandler("zoom",()=>e.zoom=o.viewport.getZoom())}}},k=(e,o,t)=>Math.min(t,Math.max(e,o)),c=[0,.5,1,2,3,4],B={mixins:[w.default.Mixin],props:{viewer:Object},data(){return{zoom:null,start_zoom:void 0,box:void 0}},computed:{wrapper_style(){const{height:e,width:o}=this.viewer.navigator.element.getBoundingClientRect();return{right:`${o}px`,height:`${e}px`}},handle_style(){return{bottom:`${100*(this.zoom.current-this.zoom.min)/this.zoom.range}%`}},mousetrap(){return{"+=":()=>this.nextZoom(),"-":()=>this.prevZoom()}}},mounted(){this.viewer.addHandler("zoom",this.setZoom),this.viewer.addOnceHandler("open",this.setZoom)},methods:{setZoom(){this.zoom={current:this.viewer.viewport.getZoom(),min:this.viewer.viewport.getMinZoom(),max:this.viewer.viewport.getMaxZoom()},this.zoom.range=this.zoom.max-this.zoom.min},dragstart(){this.box=this.$el.getBoundingClientRect(),this.start_zoom=this.viewer.viewport.getZoom()},drag(e){const{xy_start:o,xy:t}=e._drag,s=(o[1]-t[1])/this.box.height;this.applyZoom(this.start_zoom+s*this.zoom.range)},applyZoom(e){this.viewer.viewport.zoomTo(k(e,this.zoom.min,this.zoom.max))},nextZoom(){const e=c.findIndex(o=>o>this.zoom.current);this.applyZoom(c[e])},prevZoom(){const e=c.slice().reverse(),o=e.findIndex(t=>t<this.zoom.current);this.applyZoom(e[o])}}},C=n.createElementVNode("div",{class:"osd-zoom-controls__track"},null,-1);function S(e,o,t,s,r,i){const m=n.resolveComponent("unrest-draggable");return r.zoom?(n.openBlock(),n.createElementBlock("div",{key:0,class:"osd-zoom-controls",style:n.normalizeStyle(i.wrapper_style)},[C,n.createVNode(m,{class:"osd-zoom-controls__current",style:n.normalizeStyle(i.handle_style),onDragstart:i.dragstart,onDrag:i.drag},null,8,["style","onDragstart","onDrag"])],4)):n.createCommentVNode("",!0)}const u=l(B,[["render",S]]);return{HtmlOverlay:h,Store:O,ZoomControls:u,install(e){e.component("OsdHtmlOverlay",h),e.component("OsdZoomControls",u),e.component("OsdViewer",z)}}});
