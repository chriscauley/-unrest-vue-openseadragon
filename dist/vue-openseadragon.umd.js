(function(a,s){typeof exports=="object"&&typeof module<"u"?module.exports=s(require("openseadragon"),require("vue"),require("@unrest/vue-mousetrap")):typeof define=="function"&&define.amd?define(["openseadragon","vue","@unrest/vue-mousetrap"],s):(a=typeof globalThis<"u"?globalThis:a||self,a["@unrest/vue-openseadragon"]=s(a.openseadragon,a.Vue,a["@unrest/vue-mousetrap"]))})(this,function(a,s,_){"use strict";const p=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},l=p(a),f=p(_),c=(e,o)=>{const t=e.__vccOpts||e;for(const[n,r]of o)t[n]=r;return t},g={props:{osd_store:Object},emits:["viewer-bound"],data(){var t;const e=!!((t=this.$auth.user)!=null&&t.is_superuser);return{osd_options:{maxZoomPixelRatio:e?8:4,navigatorAutoFade:!1,showNavigator:!0,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,showRotationControl:!1,debugmode:!1,clickTimeThreshold:1e3,mouseNavEnabled:!e,gestureSettingsMouse:{clickToZoom:!1,dblClickToZoom:!1}}}},computed:{is_editor(){var e;return!!((e=this.$auth.user)!=null&&e.is_superuser)}},watch:{is_editor(){const{viewer:e}=this.osd_store;e.setMouseNavEnabled(!this.is_editor),e.viewport.maxZoomPixelRatio=this.is_editor?8:4}},methods:{osdWheel(e){if(!this.is_editor)return;const o=this.osd_store.viewer,t=o.viewport;if(e.ctrlKey){const n=o.container.getBoundingClientRect(),r=new l.default.Point(e.pageX-n.left,e.pageY-n.top),i=Math.pow(o.zoomPerScroll,-e.deltaY/20);t.zoomBy(i,t.pointFromPixel(r,!0))}else{const n=t.pixelFromPoint(t.getCenter(!0)),r=t.pointFromPixel(new l.default.Point(n.x+3*e.deltaX,n.y+3*e.deltaY));t.panTo(r,!1)}t.applyConstraints()},callback(e){this.osd_store.bindViewer(e),this.$emit("viewer-bound",e)}}};function w(e,o,t,n,r,i){const m=s.resolveComponent("open-seadragon");return s.openBlock(),s.createBlock(m,{onMousewheel:s.withModifiers(i.osdWheel,["prevent"]),options:r.osd_options,callback:i.callback,pixelated:!0},null,8,["onMousewheel","options","callback"])}const x=c(g,[["render",w]]),v={props:{viewer:Object},mounted(){this.viewer.addOverlay(this.$el,new l.default.Rect(0,0,1,1))}},y={class:"osd-html__overlay"};function z(e,o,t,n,r,i){return s.openBlock(),s.createElementBlock("div",y,[s.renderSlot(e.$slots,"default")])}const u=c(v,[["render",z]]),Z=()=>{const e=s.reactive({_viewer:null});return{state:e,patch:o=>Object.assign(e,o),get viewer(){return e._viewer},set viewer(o){e._viewer=o&&s.markRaw(o)},bindViewer(o){e._viewer=o,o.addHandler("zoom",()=>e.zoom=o.viewport.getZoom())}}},b=(e,o,t)=>Math.min(t,Math.max(e,o)),d=[0,.5,1,2,3,4],$={mixins:[f.default.Mixin],props:{viewer:Object},data(){return{zoom:null,start_zoom:void 0,box:void 0}},computed:{wrapper_style(){const{height:e,width:o}=this.viewer.navigator.element.getBoundingClientRect();return{right:`${o}px`,height:`${e}px`}},handle_style(){return{bottom:`${100*(this.zoom.current-this.zoom.min)/this.zoom.range}%`}},mousetrap(){return{"+=":()=>this.nextZoom(),"-":()=>this.prevZoom()}}},mounted(){this.viewer.addHandler("zoom",this.setZoom),this.viewer.addOnceHandler("open",this.setZoom)},methods:{setZoom(){this.zoom={current:this.viewer.viewport.getZoom(),min:this.viewer.viewport.getMinZoom(),max:this.viewer.viewport.getMaxZoom()},this.zoom.range=this.zoom.max-this.zoom.min},dragstart(){this.box=this.$el.getBoundingClientRect(),this.start_zoom=this.viewer.viewport.getZoom()},drag(e){const{xy_start:o,xy:t}=e._drag,n=(o[1]-t[1])/this.box.height;this.applyZoom(this.start_zoom+n*this.zoom.range)},applyZoom(e){this.viewer.viewport.zoomTo(b(e,this.zoom.min,this.zoom.max))},nextZoom(){const e=d.findIndex(o=>o>this.zoom.current);this.applyZoom(d[e])},prevZoom(){const e=d.slice().reverse(),o=e.findIndex(t=>t<this.zoom.current);this.applyZoom(e[o])}}},k=s.createElementVNode("div",{class:"osd-zoom-controls__track"},null,-1);function C(e,o,t,n,r,i){const m=s.resolveComponent("unrest-draggable");return r.zoom?(s.openBlock(),s.createElementBlock("div",{key:0,class:"osd-zoom-controls",style:s.normalizeStyle(i.wrapper_style)},[k,s.createVNode(m,{class:"osd-zoom-controls__current",style:s.normalizeStyle(i.handle_style),onDragstart:i.dragstart,onDrag:i.drag},null,8,["style","onDragstart","onDrag"])],4)):s.createCommentVNode("",!0)}const h=c($,[["render",C]]);return{HtmlOverlay:u,Store:Z,ZoomControls:h,install(e){e.component("OsdHtmlOverlay",u),e.component("OsdZoomControls",h),e.component("OsdViewer",x)}}});
