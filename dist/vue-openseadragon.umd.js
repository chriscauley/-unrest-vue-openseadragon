(function(a,n){typeof exports=="object"&&typeof module<"u"?module.exports=n(require("openseadragon"),require("vue"),require("@unrest/vue-mousetrap")):typeof define=="function"&&define.amd?define(["openseadragon","vue","@unrest/vue-mousetrap"],n):(a=typeof globalThis<"u"?globalThis:a||self,a["@unrest/vue-openseadragon"]=n(a.openseadragon,a.Vue,a["@unrest/vue-mousetrap"]))})(this,function(a,n,_){"use strict";const p=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},d=p(a),w=p(_),l=(e,o)=>{const t=e.__vccOpts||e;for(const[s,i]of o)t[s]=i;return t},f={props:{id:{type:String,default:"openseadragon-viewer"},options:Object,events:Object,pixelated:Boolean},emits:["viewer-bound"],data(){return{viewer:null}},mounted(){const{...e}=this.options;e.element=this.$el,window.viewer_jawn=this.viewer=new d.default(e);const{viewport:o}=this.viewer;o.centerSpringY.animationTime=.25,o.centerSpringX.animationTime=.25,o.zoomSpring.animationTime=.25,this.bindEvents(),this.$emit("viewer-bound",this.viewer);const t=()=>{if(this.pixelated){const{drawer:s,viewport:i}=this.viewer;s.context.imageSmoothingEnabled=i.getZoom()<.5}};this.viewer.addHandler("zoom",t),this.viewer.addOnceHandler("tile-loaded",t)},methods:{bindEvents(){const{events:e={},viewer:o}=this;Object.entries(e).forEach(([t,s])=>o.addHandler(t,s))}}},g=["id"];function v(e,o,t,s,i,r){return n.openBlock(),n.createElementBlock("div",{id:t.id,class:"osd-wrapper"},null,8,g)}const x={components:{OpenSeadragon:l(f,[["render",v]])},props:{osd_store:Object,editor_mode:Boolean,osd_options:Object},emits:["viewer-bound"],data(){const{editor_mode:e}=this,o={maxZoomPixelRatio:e?8:4,navigatorAutoFade:!1,showNavigator:!0,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,showRotationControl:!1,debugmode:!1,clickTimeThreshold:1e3,gestureSettingsMouse:{clickToZoom:!1,dblClickToZoom:!1},...this.osd_options};return o.mouseNavEnabled===void 0&&(o.mouseNavEnabled=!e),{prepped_osd_options:o,viewer:null}},watch:{osd_options:{deep:!0,handler(){this.viewer.setMouseNavEnabled(!!this.osd_options.mouseNavEnabled)}},editor_mode(){var t,s;const{viewer:e}=this,o=(s=(t=this.osd_options)==null?void 0:t.mouseNavEnabled)!=null?s:!0;e.setMouseNavEnabled(!this.editor_mode&&o),e.viewport.maxZoomPixelRatio=this.editor_mode?8:4}},methods:{osdWheel(e){if(!this.editor_mode||!this.osd_options.mouseNavEnabled)return;const{viewer:o}=this,t=o.viewport;if(e.ctrlKey){const s=o.container.getBoundingClientRect(),i=new d.default.Point(e.pageX-s.left,e.pageY-s.top),r=Math.pow(o.zoomPerScroll,-e.deltaY/20);t.zoomBy(r,t.pointFromPixel(i,!0))}else{const s=t.pixelFromPoint(t.getCenter(!0)),i=t.pointFromPixel(new d.default.Point(s.x+3*e.deltaX,s.y+3*e.deltaY));t.panTo(i,!1)}t.applyConstraints()},callback(e){var o;this.viewer=e,(o=this.osd_store)==null||o.bindViewer(e),this.$emit("viewer-bound",e)}}};function b(e,o,t,s,i,r){const m=n.resolveComponent("open-seadragon");return n.openBlock(),n.createBlock(m,{onMousewheel:n.withModifiers(r.osdWheel,["prevent"]),options:i.prepped_osd_options,onViewerBound:r.callback,pixelated:!0},null,8,["onMousewheel","options","onViewerBound"])}const y=l(x,[["render",b]]),z={props:{viewer:Object},mounted(){this.viewer.addOverlay(this.$el,new d.default.Rect(0,0,1,1))}},Z={class:"osd-html__overlay"};function $(e,o,t,s,i,r){return n.openBlock(),n.createElementBlock("div",Z,[n.renderSlot(e.$slots,"default")])}const h=l(z,[["render",$]]),O=()=>{const e=n.reactive({_viewer:null});return{state:e,patch:o=>Object.assign(e,o),get viewer(){return e._viewer},set viewer(o){e._viewer=o&&n.markRaw(o)},bindViewer(o){e._viewer=o,o.addHandler("zoom",()=>e.zoom=o.viewport.getZoom())}}},k=(e,o,t)=>Math.min(t,Math.max(e,o)),c=[0,.5,1,2,3,4],B={mixins:[w.default.Mixin],props:{viewer:Object},data(){return{zoom:null,start_zoom:void 0,box:void 0}},computed:{wrapper_style(){const{height:e,width:o}=this.viewer.navigator.element.getBoundingClientRect();return{right:`${o}px`,height:`${e}px`}},handle_style(){return{bottom:`${100*(this.zoom.current-this.zoom.min)/this.zoom.range}%`}},mousetrap(){return{"+=":()=>this.nextZoom(),"-":()=>this.prevZoom()}}},mounted(){this.viewer.addHandler("zoom",this.setZoom),this.viewer.addOnceHandler("open",this.setZoom)},methods:{setZoom(){this.zoom={current:this.viewer.viewport.getZoom(),min:this.viewer.viewport.getMinZoom(),max:this.viewer.viewport.getMaxZoom()},this.zoom.range=this.zoom.max-this.zoom.min},dragstart(){this.box=this.$el.getBoundingClientRect(),this.start_zoom=this.viewer.viewport.getZoom()},drag(e){const{xy_start:o,xy:t}=e._drag,s=(o[1]-t[1])/this.box.height;this.applyZoom(this.start_zoom+s*this.zoom.range)},applyZoom(e){this.viewer.viewport.zoomTo(k(e,this.zoom.min,this.zoom.max))},nextZoom(){const e=c.findIndex(o=>o>this.zoom.current);this.applyZoom(c[e])},prevZoom(){const e=c.slice().reverse(),o=e.findIndex(t=>t<this.zoom.current);this.applyZoom(e[o])}}},C=n.createElementVNode("div",{class:"osd-zoom-controls__track"},null,-1);function E(e,o,t,s,i,r){const m=n.resolveComponent("unrest-draggable");return i.zoom?(n.openBlock(),n.createElementBlock("div",{key:0,class:"osd-zoom-controls",style:n.normalizeStyle(r.wrapper_style)},[C,n.createVNode(m,{class:"osd-zoom-controls__current",style:n.normalizeStyle(r.handle_style),onDragstart:r.dragstart,onDrag:r.drag},null,8,["style","onDragstart","onDrag"])],4)):n.createCommentVNode("",!0)}const u=l(B,[["render",E]]);return{HtmlOverlay:h,Store:O,ZoomControls:u,install(e){e.component("OsdHtmlOverlay",h),e.component("OsdZoomControls",u),e.component("OsdViewer",y)}}});
